#include <stdio.h>
#include <string.h>
#include "store_functions.h"

int main(int argv, char* argc[]){

    struct article_type db[SIZE_DB];//arrays haben leider eine feste länge, wahrscheinlich soll aus dem array eine liste werden
    int i;
    double trash;

    /*fill new database with nothingness*/
    for(i=0; i < SIZE_DB; i++){
        db[i].amount = 0;
        db[i].price = 0;
        get_price_category(db[i]);
        strcpy(db[i].name, "<empty>");
    }

    //Benutzeroberfläche
    int option_number = 0;
    while(option_number == 0){
        printf("Choose one of the following options:\n"
               "[1] printing\n"
               "[2] edit\n"
               "[3] save the database\n"
               "[4] load the database\n"
               "[5] close program\n");
        scanf("%i",&option_number); //optionswahl durch user

        /* option print*/
        if(option_number == 1){
            option_number = 0;
            printf("Choose one of the following options:\n"
                   "[1] print the whole database\n"
                   "[2] print most expensive article\n"
                   "[3] print cheapest article\n"
                   "[4] search and print an article by name\n"
                   "[0] back\n");
            scanf("%i",&option_number);

            /*unteroptionen für printing*/

            /*print whole database*/
            if(option_number == 1){
                double running_total = 0.0;
                print_table_header();
                for(i=0; i < SIZE_DB; i++){
                    if(strcmp(db[i].name, "<empty>") != 0){
                        printf("%i\t",i);
                        print_article(db[i]);
                        running_total += db[i].price*db[i].amount;
                }
            }
                printf("\t\t\t\tTotal:%17.2f\n", running_total);
            option_number = 0;
            }

            /*print most expensive article*/
            else if(option_number == 2){
                printf("The most expensive article is:\n");
                print_table_header();
                print_article(maximum(db));
                option_number = 0;
            }

            /*print cheapest article*/
            else if(option_number == 3){
                printf("The cheapest article is:\n");
                print_table_header();
                print_article(minimum(db));
                option_number = 0;
            }

            /*search an article with binary search and print it*/
            else if(option_number == 4){
                printf("Which article do u search?\n");
                char searched_article[100];
                scanf("%s", &searched_article);
                quicksort_name(db,1,biggest_entry(db));
                binary_search_article(db,searched_article,1,biggest_entry(db));
                option_number = 0;
            }
        }

        /* show options to edit the database*/
        else if(option_number == 2){
            option_number = 0;
            printf("Choose one of the following options:\n"
                   "[1] make a new entry in the database\n"
                   "[2] change an entry\n"
                   "[3] delete one entry\n"
                   "[4] sorting option\n"
                   "[0] back\n");
            scanf("%i",&option_number);

            /*unteroptionen für edit*/

                /*entry insert/change*/
            if(option_number == 1){
                i=1;
                while(1){
                    if(strcmp(db[i].name, "<empty>") == 0) {
                        entry_article(&db[i]);
                        break;
                    }else if(i == SIZE_DB){
                        printf("Your database is full");
                        break;
                    }
                    i++;
                }
                option_number = 0;
            }
                /*change a specific entry*/
            else if(option_number == 2){
                printf("Which entry do you want to change?\n"
                       "Type in the entry number:\n");
                scanf("%i",&i);
                entry_article(&db[i]);
                option_number = 0;
            }
                /*entry delete*/
            else if(option_number == 3){
                int index_of_delete;
                printf("Which article do u want to delete:\n");
                scanf("%i", &index_of_delete);
                delete_article(db,index_of_delete);
                option_number = 0;
            }
                /*sorting options*/
            else if(option_number == 4){
                option_number = 0;
                printf("Choose one of the following options:\n"
                       "[1] turn around the database\n"
                       "[2] sort the database from lowest to highest price\n"
                       "[3] sort the database by name (a-z)\n"
                       "[0] back\n");
                scanf("%i",&option_number);

                /*turn around the database*/
                if(option_number == 1){
                    turn_around(db);
                    option_number = 0;
                }
                    /*quicksort_price via price*/
                else if(option_number == 2){
                    quicksort_price(db,1,biggest_entry(db));
                    option_number = 0;
                }
                    /*quicksort_price via name*/
                else if(option_number == 3){
                    quicksort_name(db,1,biggest_entry(db));
                    option_number = 0;
                }
                /*back*/
                else if(option_number == 0){
                    continue;
                }

                else{
                    option_number = 0;
                }
            }
                /*back*/
            else if(option_number == 0){
                continue;
            }
            else{
                option_number = 0;
            }
        }

        /*option to save the database*/
        else if(option_number == 3){

            FILE *db_save;

            db_save = fopen("C:/Users/garri/CLionProjects/Uebung Praktische Informatik/Database.txt", "wb");
            /*fehlerprüfung*/
            if(db_save == NULL){
                printf("file error occurred");
                return 1;
            }else{
                /*tatsächliches schreiben in datei*/
                fprintf(db_save, "x");
                for (i = 0; i < SIZE_DB; i++) {
                    if (strcmp(db[i].name, "<empty>") != 0) {
                        fprintf(db_save, "%s %i %.2f %.2f %s ",
                                db[i].name, db[i].amount, db[i].price, db[i].price * db[i].amount, db[i].price_c);

                    }
                }
            }
            fclose(db_save);
            option_number = 0;
        }

        /*option to load the database*/
        else if(option_number == 4){
            FILE *db_read;
            if((db_read=fopen("C:/Users/garri/CLionProjects/Uebung Praktische Informatik/Database.txt", "r")) == NULL){
                printf("loading unsuccessful\n");
            }else{
                for(i=1; i < SIZE_DB; i++){
                    if(fgetc(db_read) != EOF){
                        fscanf(db_read, "%s %i %lf %lf %s", &db[i].name, &db[i].amount, &db[i].price, &trash, &db[i].price_c);
                    }else{
                        fclose(db_read);
                        break;
                    }
                }
                printf("loading successful\n");
            }
            option_number = 0;
        }

        /*option to close the program*/
        else if(option_number == 5){
            break;
        }

        /*meldung bei ungültiger optionswahl*/
        else{
            printf("There is no option %i.\n", option_number);
            option_number = 0;
        }
    }
    return 0;
}